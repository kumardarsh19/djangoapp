
<!DOCTYPE html>
<head>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>

<body>
    <form enctype="multipart/form-data" method="post">
        {% csrf_token %}
        <table>
            {{form.as_p}}
        </table>
        <input type="submit" value="Submit">
    </form>


    <div id="notebox" >
        {%if notes %}
            {{notes}}
        {% endif %}
    </div>

    <script>
        var path = "/static/vexflow/src/vex.ts";
    </script>

    <script src="https://unpkg.com/vexflow@4.1.0/build/cjs/vexflow-debug.js"></script>

    {%if notes %}
        <div id="boo"></div>

        <script>
        notelist = document.getElementById("notebox").innerHTML;
        notelist = {{notes|safe}};
        console.log(typeof notelist)
        console.log(notelist);
        console.log("Entered writeNotes")

        const { Renderer, Stave, StaveNote, Voice, Formatter } = Vex.Flow;

        // Create an SVG renderer and attach it to the DIV element named "boo".
        const div = document.getElementById("boo");
        const renderer = new Renderer(div, Renderer.Backends.SVG);

        // Configure the rendering context.
        renderer.resize(500, 500);
        const context = renderer.getContext();

        // Create a stave of width 400 at position 10, 40 on the canvas.
        const stave = new Stave(10, 40, 400);

        // Add a clef and time signature.
        stave.addClef("treble").addTimeSignature("4/4");

        // Connect it to the rendering context and draw!
        stave.setContext(context).draw();

        // Create the notes
        let notes = [];

        for (let i=0; i<notelist.length; i = i+4) {
            console.log(i);
            newkey = String(notelist[i]) + "/4";
            console.log(newkey);
            currNote = new StaveNote({keys: [newkey], duration: "q"});
            notes.push(currNote);
        }

        // Create a voice in 4/4 and add above notes
        const voice = new Voice({ num_beats: 10, beat_value: 10 });
        voice.addTickables(notes.slice(0, 4));

        // Format and justify the notes to 400 pixels.
        new Formatter().joinVoices([voice]).format([voice], 350);

        // Render voice
        voice.draw(context, stave);
        </script>
    {% endif %}
    
    {% comment %} Javascript links for Bootstrap {% endcomment %}
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
</body>